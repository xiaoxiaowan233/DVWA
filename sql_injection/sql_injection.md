# sql注入



##sql注入的产生

* Web开发人员无法保证所有的输入已经过滤
* 攻击者利用发送给sql服务器的输入数据构造可执行的SQL代码
* 数据库未做相应的安全配置



## 寻找sql注入漏洞

### 借助逻辑推理

* 识别Web应用中的所有输入点
* 了解哪些类型的请求会触发异常（特殊字符：引号引发数据库异常）
* 检测服务器响应中的异常（500、404等）



### 如何进行注入攻击

* 数字注入（输入中有数字）

例如服务器代码中含有以下代码，`$id`为用户输入的查询编号

```php
$sql = "select * from 表 where id = ".$id
```

如果想通过数字注入查询数据库中整张表的内容，那么需要`id =` 条件永远为真，可以类似于以下构造,在提交表单时按照此逻辑。

`id = -1 or 1 = 1`



* 字符串注入

够造字符串达到免密登陆等效果，mysql里可以用“#”注释

```mysql
select * from 表 where user_name = 'james'#' AND pwd = "任意"
```

mysql中也可以用"-- "进行注释

```mysql
select * from 表 where user_name = 'james'--  AND pwd = "任意"
```



## 预防sql注入

* 输入变量检查
* 转移特殊字符（严格检查输入变量的格式和类型）
* 预编译机制